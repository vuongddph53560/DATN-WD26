{"version":3,"file":"devBrowser-DwTLFX_-.js","names":["url: URL","jwt: string","_url: URL"],"sources":["../../src/devBrowser.ts"],"sourcesContent":["export const DEV_BROWSER_JWT_KEY = '__clerk_db_jwt';\nexport const DEV_BROWSER_JWT_HEADER = 'Clerk-Db-Jwt';\n\n// Sets the dev_browser JWT in the hash or the search\nexport function setDevBrowserJWTInURL(url: URL, jwt: string): URL {\n  const resultURL = new URL(url);\n\n  // extract & strip existing jwt from search\n  const jwtFromSearch = resultURL.searchParams.get(DEV_BROWSER_JWT_KEY);\n  resultURL.searchParams.delete(DEV_BROWSER_JWT_KEY);\n\n  // Existing jwt takes precedence\n  const jwtToSet = jwtFromSearch || jwt;\n\n  if (jwtToSet) {\n    resultURL.searchParams.set(DEV_BROWSER_JWT_KEY, jwtToSet);\n  }\n\n  return resultURL;\n}\n\n/**\n * Gets the __clerk_db_jwt JWT from either the hash or the search\n * Side effect:\n * Removes __clerk_db_jwt JWT from the URL (hash and searchParams) and updates the browser history\n */\nexport function extractDevBrowserJWTFromURL(url: URL): string {\n  const jwt = readDevBrowserJwtFromSearchParams(url);\n  const cleanUrl = removeDevBrowserJwt(url);\n  if (cleanUrl.href !== url.href && typeof globalThis.history !== 'undefined') {\n    globalThis.history.replaceState(null, '', removeDevBrowserJwt(url));\n  }\n  return jwt;\n}\n\nconst readDevBrowserJwtFromSearchParams = (url: URL) => {\n  return url.searchParams.get(DEV_BROWSER_JWT_KEY) || '';\n};\n\nconst removeDevBrowserJwt = (url: URL) => {\n  return removeDevBrowserJwtFromURLSearchParams(removeLegacyDevBrowserJwt(url));\n};\n\nconst removeDevBrowserJwtFromURLSearchParams = (_url: URL) => {\n  const url = new URL(_url);\n  url.searchParams.delete(DEV_BROWSER_JWT_KEY);\n  return url;\n};\n\n/**\n * Removes the __clerk_db_jwt JWT from the URL hash, as well as\n * the legacy __dev_session JWT from the URL searchParams\n * We no longer need to use this value, however, we should remove it from the URL\n * Existing v4 apps will write the JWT to the hash and the search params in order to ensure\n * backwards compatibility with older v4 apps.\n * The only use case where this is needed now is when a user upgrades to clerk@5 locally\n * without changing the component's version on their dashboard.\n * In this scenario, the AP@4 -> localhost@5 redirect will still have the JWT in the hash,\n * in which case we need to remove it.\n */\nconst removeLegacyDevBrowserJwt = (_url: URL) => {\n  const DEV_BROWSER_JWT_MARKER_REGEXP = /__clerk_db_jwt\\[(.*)\\]/;\n  const DEV_BROWSER_JWT_LEGACY_KEY = '__dev_session';\n  const url = new URL(_url);\n  url.searchParams.delete(DEV_BROWSER_JWT_LEGACY_KEY);\n  url.hash = decodeURI(url.hash).replace(DEV_BROWSER_JWT_MARKER_REGEXP, '');\n  if (url.href.endsWith('#')) {\n    url.hash = '';\n  }\n  return url;\n};\n"],"mappings":";;AAAA,MAAa,sBAAsB;AACnC,MAAa,yBAAyB;AAGtC,SAAgB,sBAAsBA,KAAUC,KAAkB;CAChE,MAAM,YAAY,IAAI,IAAI;CAG1B,MAAM,gBAAgB,UAAU,aAAa,IAAI,oBAAoB;AACrE,WAAU,aAAa,OAAO,oBAAoB;CAGlD,MAAM,WAAW,iBAAiB;AAElC,KAAI,SACF,WAAU,aAAa,IAAI,qBAAqB,SAAS;AAG3D,QAAO;AACR;;;;;;AAOD,SAAgB,4BAA4BD,KAAkB;CAC5D,MAAM,MAAM,kCAAkC,IAAI;CAClD,MAAM,WAAW,oBAAoB,IAAI;AACzC,KAAI,SAAS,SAAS,IAAI,eAAe,WAAW,YAAY,YAC9D,YAAW,QAAQ,aAAa,MAAM,IAAI,oBAAoB,IAAI,CAAC;AAErE,QAAO;AACR;AAED,MAAM,oCAAoC,CAACA,QAAa;AACtD,QAAO,IAAI,aAAa,IAAI,oBAAoB,IAAI;AACrD;AAED,MAAM,sBAAsB,CAACA,QAAa;AACxC,QAAO,uCAAuC,0BAA0B,IAAI,CAAC;AAC9E;AAED,MAAM,yCAAyC,CAACE,SAAc;CAC5D,MAAM,MAAM,IAAI,IAAI;AACpB,KAAI,aAAa,OAAO,oBAAoB;AAC5C,QAAO;AACR;;;;;;;;;;;;AAaD,MAAM,4BAA4B,CAACA,SAAc;CAC/C,MAAM,gCAAgC;CACtC,MAAM,6BAA6B;CACnC,MAAM,MAAM,IAAI,IAAI;AACpB,KAAI,aAAa,OAAO,2BAA2B;AACnD,KAAI,OAAO,UAAU,IAAI,KAAK,CAAC,QAAQ,+BAA+B,GAAG;AACzE,KAAI,IAAI,KAAK,SAAS,IAAI,CACxB,KAAI,OAAO;AAEb,QAAO;AACR"}